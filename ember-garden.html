<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ember Garden</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400&display=swap');
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        void: '#000000',
                        ash: '#2a2a2a',
                        ember: '#ff6b35',
                        emberGlow: '#ff9f1c',
                        golden: '#ffd700',
                        warmth: '#ff4500',
                        coal: '#1a1a1a',
                    },
                    fontFamily: {
                        ember: ['Cormorant Garamond', 'serif'],
                    },
                },
            },
        };
    </script>
</head>
<body class="overflow-hidden bg-black">
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        // Vocabulary - words to learn
        const vocabulary = [
            { id: 1, word: 'ephemeral', definition: 'lasting for a very short time', hint: 'like morning dew' },
            { id: 2, word: 'luminous', definition: 'full of or shedding light', hint: 'bright, radiant' },
            { id: 3, word: 'serenity', definition: 'the state of being calm and peaceful', hint: 'tranquility' },
            { id: 4, word: 'ethereal', definition: 'extremely delicate and light', hint: 'otherworldly' },
            { id: 5, word: 'resonance', definition: 'the quality of being deep and full', hint: 'echo, vibration' },
            { id: 6, word: 'solitude', definition: 'the state of being alone', hint: 'isolation, peace' },
            { id: 7, word: 'melancholy', definition: 'a deep, pensive sadness', hint: 'bittersweet sorrow' },
            { id: 8, word: 'transcend', definition: 'to rise above or go beyond limits', hint: 'surpass, exceed' },
        ];

        function EmberGarden() {
            // Word states
            const [words, setWords] = useState([]);
            const [hoveredWord, setHoveredWord] = useState(null);
            const [revealedWord, setRevealedWord] = useState(null);
            const [masteredWords, setMasteredWords] = useState([]);
            const [burningWords, setBurningWords] = useState([]);

            // Visual state
            const [embers, setEmbers] = useState([]);
            const [warmth, setWarmth] = useState(0);
            const [sessionComplete, setSessionComplete] = useState(false);

            // Demo controls
            const [showDemoControls, setShowDemoControls] = useState(true);

            const audioContextRef = useRef(null);

            // Initialize
            useEffect(() => {
                audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();

                // Place words randomly
                const initialWords = vocabulary.map((v, i) => ({
                    ...v,
                    x: 15 + Math.random() * 70,
                    y: 15 + Math.random() * 60,
                    drift: Math.random() * Math.PI * 2,
                    attempts: 0,
                    mastered: false,
                }));
                setWords(initialWords);

                // Generate background embers
                const initialEmbers = [];
                for (let i = 0; i < 50; i++) {
                    initialEmbers.push({
                        id: i,
                        x: Math.random() * 100,
                        y: Math.random() * 100,
                        size: 1 + Math.random() * 3,
                        speed: 0.02 + Math.random() * 0.03,
                        brightness: 0.2 + Math.random() * 0.3,
                        phase: Math.random() * Math.PI * 2,
                    });
                }
                setEmbers(initialEmbers);

                return () => audioContextRef.current?.close();
            }, []);

            // Animate embers rising
            useEffect(() => {
                const interval = setInterval(() => {
                    setEmbers(prev => prev.map(e => ({
                        ...e,
                        y: e.y - e.speed,
                        x: e.x + Math.sin(e.phase) * 0.02,
                        phase: e.phase + 0.02,
                        brightness: e.brightness + Math.sin(e.phase * 2) * 0.05,
                    })).map(e => e.y < 0 ? { ...e, y: 100, x: Math.random() * 100 } : e));
                }, 50);
                return () => clearInterval(interval);
            }, []);

            // Gentle word drift
            useEffect(() => {
                const interval = setInterval(() => {
                    setWords(prev => prev.map(w => ({
                        ...w,
                        x: w.x + Math.sin(w.drift) * 0.02,
                        y: w.y + Math.cos(w.drift) * 0.01,
                        drift: w.drift + 0.005,
                    })));
                }, 50);
                return () => clearInterval(interval);
            }, []);

            // Update warmth based on progress
            useEffect(() => {
                const progress = (masteredWords.length / vocabulary.length) * 100;
                setWarmth(progress);

                if (masteredWords.length === vocabulary.length && !sessionComplete) {
                    setSessionComplete(true);
                    playSound('complete');
                }
            }, [masteredWords.length]);

            // Play sounds
            const playSound = useCallback((type) => {
                if (!audioContextRef.current) return;
                const ctx = audioContextRef.current;

                if (type === 'hover') {
                    // Soft warm tone
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.value = 220;
                    gain.gain.setValueAtTime(0.05, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
                    osc.connect(gain).connect(ctx.destination);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.3);
                } else if (type === 'reveal') {
                    // Gentle chime
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.value = 440;
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.5);
                    osc.connect(gain).connect(ctx.destination);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.5);
                } else if (type === 'solidify') {
                    // Warm harmonic
                    [220, 330, 440].forEach((freq, i) => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.type = 'sine';
                        osc.frequency.value = freq;
                        gain.gain.setValueAtTime(0.08, ctx.currentTime + i * 0.1);
                        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 2);
                        osc.connect(gain).connect(ctx.destination);
                        osc.start(ctx.currentTime + i * 0.1);
                        osc.stop(ctx.currentTime + 2);
                    });
                } else if (type === 'burn') {
                    // Crackling fade
                    const noise = ctx.createBufferSource();
                    const buffer = ctx.createBuffer(1, ctx.sampleRate * 1, ctx.sampleRate);
                    const data = buffer.getChannelData(0);
                    for (let i = 0; i < data.length; i++) {
                        const env = Math.exp(-i / (ctx.sampleRate * 0.3));
                        data[i] = (Math.random() * 2 - 1) * env * 0.1;
                    }
                    noise.buffer = buffer;
                    const filter = ctx.createBiquadFilter();
                    filter.type = 'lowpass';
                    filter.frequency.value = 800;
                    noise.connect(filter).connect(ctx.destination);
                    noise.start();
                } else if (type === 'complete') {
                    // Completion harmony
                    const baseFreq = 220;
                    [1, 1.25, 1.5, 2, 2.5, 3].forEach((mult, i) => {
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        osc.type = 'sine';
                        osc.frequency.value = baseFreq * mult;
                        gain.gain.setValueAtTime(0.06, ctx.currentTime + i * 0.2);
                        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 4);
                        osc.connect(gain).connect(ctx.destination);
                        osc.start(ctx.currentTime + i * 0.2);
                        osc.stop(ctx.currentTime + 4);
                    });
                }
            }, []);

            // Handle word click - reveal definition
            const handleWordClick = useCallback((word) => {
                if (word.mastered) return;
                playSound('reveal');
                setRevealedWord(word);
            }, [playSound]);

            // Handle correct - solidify word
            const handleCorrect = useCallback(() => {
                if (!revealedWord) return;
                playSound('solidify');

                // Mark as mastered
                setWords(prev => prev.map(w =>
                    w.id === revealedWord.id ? { ...w, mastered: true } : w
                ));
                setMasteredWords(prev => [...prev, revealedWord.id]);

                // Add golden embers
                const newEmbers = [];
                for (let i = 0; i < 10; i++) {
                    newEmbers.push({
                        id: Date.now() + i,
                        x: revealedWord.x + (Math.random() - 0.5) * 10,
                        y: revealedWord.y,
                        size: 2 + Math.random() * 2,
                        speed: 0.01 + Math.random() * 0.02,
                        brightness: 0.8 + Math.random() * 0.2,
                        phase: Math.random() * Math.PI * 2,
                        golden: true,
                    });
                }
                setEmbers(prev => [...prev, ...newEmbers]);

                setRevealedWord(null);
            }, [revealedWord, playSound]);

            // Handle wrong - burn and respawn
            const handleWrong = useCallback(() => {
                if (!revealedWord) return;
                playSound('burn');

                // Add to burning animation
                setBurningWords(prev => [...prev, revealedWord.id]);

                // After burn animation, respawn word elsewhere
                setTimeout(() => {
                    setBurningWords(prev => prev.filter(id => id !== revealedWord.id));
                    setWords(prev => prev.map(w =>
                        w.id === revealedWord.id
                            ? {
                                ...w,
                                x: 15 + Math.random() * 70,
                                y: 15 + Math.random() * 60,
                                attempts: w.attempts + 1,
                            }
                            : w
                    ));
                }, 1500);

                setRevealedWord(null);
            }, [revealedWord, playSound]);

            // Reset session
            const resetSession = useCallback(() => {
                const newWords = vocabulary.map((v, i) => ({
                    ...v,
                    x: 15 + Math.random() * 70,
                    y: 15 + Math.random() * 60,
                    drift: Math.random() * Math.PI * 2,
                    attempts: 0,
                    mastered: false,
                }));
                setWords(newWords);
                setMasteredWords([]);
                setBurningWords([]);
                setSessionComplete(false);
                setRevealedWord(null);
            }, []);

            return (
                <div className="w-screen h-screen bg-void relative overflow-hidden font-ember">
                    {/* Warmth gradient from bottom */}
                    <div
                        className="absolute bottom-0 left-0 right-0 pointer-events-none transition-all duration-1000"
                        style={{
                            height: `${warmth * 0.5}%`,
                            background: `linear-gradient(to top,
                                rgba(255, 69, 0, ${warmth / 300}) 0%,
                                rgba(255, 107, 53, ${warmth / 500}) 50%,
                                transparent 100%
                            )`,
                        }}
                    />

                    {/* Background embers */}
                    {embers.map(e => (
                        <div
                            key={e.id}
                            className={`absolute rounded-full ${e.golden ? 'bg-golden' : 'bg-ember'}`}
                            style={{
                                left: `${e.x}%`,
                                top: `${e.y}%`,
                                width: e.size,
                                height: e.size,
                                opacity: Math.max(0.1, Math.min(0.8, e.brightness)),
                                boxShadow: e.golden
                                    ? `0 0 ${e.size * 3}px rgba(255, 215, 0, 0.5)`
                                    : `0 0 ${e.size * 2}px rgba(255, 107, 53, 0.3)`,
                            }}
                        />
                    ))}

                    {/* Words */}
                    {words.map(word => {
                        const isHovered = hoveredWord === word.id;
                        const isBurning = burningWords.includes(word.id);
                        const isMastered = word.mastered;

                        return (
                            <div
                                key={word.id}
                                className={`absolute cursor-pointer transition-all duration-500 select-none
                                          ${isBurning ? 'animate-burn' : ''}`}
                                style={{
                                    left: `${word.x}%`,
                                    top: `${word.y}%`,
                                    transform: 'translate(-50%, -50%)',
                                }}
                                onMouseEnter={() => {
                                    if (!isMastered && !isBurning) {
                                        setHoveredWord(word.id);
                                        playSound('hover');
                                    }
                                }}
                                onMouseLeave={() => setHoveredWord(null)}
                                onClick={() => !isMastered && !isBurning && handleWordClick(word)}
                            >
                                <div
                                    className={`text-2xl tracking-widest transition-all duration-300
                                              ${isMastered
                                                ? 'text-golden'
                                                : isHovered
                                                    ? 'text-emberGlow'
                                                    : 'text-ash/30'
                                              }
                                              ${isBurning ? 'opacity-0 scale-150' : 'opacity-100'}`}
                                    style={{
                                        textShadow: isMastered
                                            ? '0 0 20px rgba(255, 215, 0, 0.5), 0 0 40px rgba(255, 215, 0, 0.3)'
                                            : isHovered
                                                ? '0 0 15px rgba(255, 159, 28, 0.6), 0 0 30px rgba(255, 107, 53, 0.4)'
                                                : 'none',
                                    }}
                                >
                                    {word.word}
                                </div>

                                {/* Attempt indicator */}
                                {word.attempts > 0 && !isMastered && (
                                    <div className="absolute -bottom-4 left-1/2 transform -translate-x-1/2
                                                  text-xs text-ember/50">
                                        {Array(Math.min(word.attempts, 3)).fill('Â·').join('')}
                                    </div>
                                )}
                            </div>
                        );
                    })}

                    {/* Reveal modal */}
                    {revealedWord && (
                        <div className="fixed inset-0 flex items-center justify-center z-50">
                            {/* Backdrop */}
                            <div
                                className="absolute inset-0 bg-black/80"
                                onClick={() => setRevealedWord(null)}
                            />

                            {/* Content */}
                            <div className="relative bg-coal border border-ember/20 p-8 rounded-lg max-w-md
                                          shadow-2xl shadow-ember/10">
                                {/* Word */}
                                <div className="text-3xl text-emberGlow text-center mb-4 tracking-widest">
                                    {revealedWord.word}
                                </div>

                                {/* Definition */}
                                <div className="text-lg text-ash text-center mb-2">
                                    {revealedWord.definition}
                                </div>

                                {/* Hint */}
                                <div className="text-sm text-ember/50 text-center mb-8 italic">
                                    {revealedWord.hint}
                                </div>

                                {/* Actions */}
                                <div className="flex gap-4 justify-center">
                                    <button
                                        onClick={handleCorrect}
                                        className="px-6 py-3 bg-golden/10 hover:bg-golden/20 text-golden
                                                 border border-golden/30 rounded-lg transition-all
                                                 text-sm tracking-wider"
                                    >
                                        I knew it
                                    </button>
                                    <button
                                        onClick={handleWrong}
                                        className="px-6 py-3 bg-ember/10 hover:bg-ember/20 text-ember
                                                 border border-ember/30 rounded-lg transition-all
                                                 text-sm tracking-wider"
                                    >
                                        Show me again
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Session complete */}
                    {sessionComplete && (
                        <div className="fixed inset-0 flex items-center justify-center z-40 pointer-events-none">
                            <div className="text-center animate-pulse">
                                <div className="text-4xl text-golden mb-4 tracking-widest">
                                    Garden Complete
                                </div>
                                <div className="text-lg text-emberGlow/70 mb-8">
                                    All embers now burn eternal
                                </div>
                                <button
                                    onClick={resetSession}
                                    className="px-6 py-3 bg-ember/10 hover:bg-ember/20 text-ember
                                             border border-ember/30 rounded-lg transition-all
                                             pointer-events-auto text-sm"
                                >
                                    Begin Anew
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Progress indicator */}
                    <div className="absolute bottom-4 left-4 text-ember/30 text-xs">
                        <div>{masteredWords.length}/{vocabulary.length} embers burning</div>
                    </div>

                    {/* Demo Controls */}
                    {showDemoControls && (
                        <div className="absolute top-4 right-4 z-50">
                            <div className="bg-coal/95 border border-ember/20 p-4 rounded-lg backdrop-blur-sm max-w-xs">
                                <div className="text-xs mb-3 text-ember/70 font-bold">DEMO CONTROLS</div>

                                <div className="space-y-2 mb-3">
                                    <button
                                        onClick={() => {
                                            // Simulate correct for first unmastered word
                                            const unmasteredWord = words.find(w => !w.mastered);
                                            if (unmasteredWord) {
                                                setRevealedWord(unmasteredWord);
                                                setTimeout(() => handleCorrect(), 100);
                                            }
                                        }}
                                        className="w-full px-2 py-1 text-xs bg-golden/20 hover:bg-golden/30 text-golden rounded border border-golden/30"
                                    >
                                        Solidify Next Word
                                    </button>
                                    <button
                                        onClick={() => {
                                            // Simulate wrong for first unmastered word
                                            const unmasteredWord = words.find(w => !w.mastered);
                                            if (unmasteredWord) {
                                                setRevealedWord(unmasteredWord);
                                                setTimeout(() => handleWrong(), 100);
                                            }
                                        }}
                                        className="w-full px-2 py-1 text-xs bg-ember/20 hover:bg-ember/30 text-ember rounded border border-ember/30"
                                    >
                                        Burn Next Word
                                    </button>
                                    <button
                                        onClick={() => {
                                            playSound('solidify');
                                            // Add golden embers
                                            const newEmbers = [];
                                            for (let i = 0; i < 20; i++) {
                                                newEmbers.push({
                                                    id: Date.now() + i,
                                                    x: 30 + Math.random() * 40,
                                                    y: 30 + Math.random() * 40,
                                                    size: 2 + Math.random() * 3,
                                                    speed: 0.01 + Math.random() * 0.02,
                                                    brightness: 0.8 + Math.random() * 0.2,
                                                    phase: Math.random() * Math.PI * 2,
                                                    golden: true,
                                                });
                                            }
                                            setEmbers(prev => [...prev, ...newEmbers]);
                                        }}
                                        className="w-full px-2 py-1 text-xs bg-golden/10 hover:bg-golden/20 text-golden/70 rounded border border-golden/20"
                                    >
                                        Spawn Golden Embers
                                    </button>
                                    <button
                                        onClick={() => playSound('complete')}
                                        className="w-full px-2 py-1 text-xs bg-warmth/10 hover:bg-warmth/20 text-warmth/70 rounded border border-warmth/20"
                                    >
                                        Completion Sound
                                    </button>
                                </div>

                                {/* Warmth slider */}
                                <div className="mb-3">
                                    <label className="text-xs text-ember/50 block mb-1">
                                        Warmth: {Math.round(warmth)}%
                                    </label>
                                    <input
                                        type="range"
                                        min="0"
                                        max="100"
                                        value={warmth}
                                        onChange={(e) => setWarmth(parseInt(e.target.value))}
                                        className="w-full h-1 bg-ember/20 rounded-lg appearance-none cursor-pointer"
                                    />
                                </div>

                                {/* Mastered slider */}
                                <div className="mb-3">
                                    <label className="text-xs text-ember/50 block mb-1">
                                        Mastered: {masteredWords.length}/{vocabulary.length}
                                    </label>
                                    <input
                                        type="range"
                                        min="0"
                                        max={vocabulary.length}
                                        value={masteredWords.length}
                                        onChange={(e) => {
                                            const count = parseInt(e.target.value);
                                            const ids = vocabulary.slice(0, count).map(v => v.id);
                                            setMasteredWords(ids);
                                            setWords(prev => prev.map(w => ({
                                                ...w,
                                                mastered: ids.includes(w.id)
                                            })));
                                        }}
                                        className="w-full h-1 bg-ember/20 rounded-lg appearance-none cursor-pointer"
                                    />
                                </div>

                                {/* Stats */}
                                <div className="text-xs text-ember/30 mb-3">
                                    <div>Embers: {embers.length}</div>
                                    <div>Golden: {embers.filter(e => e.golden).length}</div>
                                </div>

                                {/* Reset */}
                                <button
                                    onClick={resetSession}
                                    className="w-full px-2 py-1 text-xs border border-ember/30 hover:bg-ember/10 text-ember/50 rounded"
                                >
                                    Reset Session
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Toggle demo */}
                    <button
                        onClick={() => setShowDemoControls(!showDemoControls)}
                        className="absolute bottom-4 right-4 text-ember/30 hover:text-ember/70 text-xs z-50"
                    >
                        {showDemoControls ? 'Hide Demo' : 'Demo'}
                    </button>

                    <style>{`
                        @keyframes burn {
                            0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
                            50% { opacity: 0.8; transform: translate(-50%, -60%) scale(1.2); filter: blur(2px); }
                            100% { opacity: 0; transform: translate(-50%, -80%) scale(0.5); filter: blur(5px); }
                        }

                        .animate-burn {
                            animation: burn 1.5s ease-out forwards;
                        }
                    `}</style>
                </div>
            );
        }

        ReactDOM.render(<EmberGarden />, document.getElementById('root'));
    </script>
</body>
</html>
